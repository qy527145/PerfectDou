# [NeurIPS 2022] PerfectDou: é€šè¿‡å®Œç¾ä¿¡æ¯è’¸é¦ä¸»å¯¼æ–—åœ°ä¸»
NeurIPS 2022 è®ºæ–‡ã€ŠPerfectDou: Dominating DouDizhu with Perfect Information Distillationã€‹çš„å®˜æ–¹ä»£ç åº“ã€‚

**æ³¨æ„ï¼šæˆ‘ä»¬ä»…å‘å¸ƒäº†é¢„è®­ç»ƒæ¨¡å‹å’Œè¯„ä¼°ä»£ç ã€‚ç”±äºä½¿ç”¨äº†åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè®­ç»ƒä»£ç ç›®å‰ä¸å¯ç”¨ã€‚è®¡ç®—å‰©ä½™æ‰‹ç‰Œå’Œç‰¹å¾å·¥ç¨‹çš„ä»£ç ä»¥å…±äº«åº“ï¼ˆå³ *.so æ–‡ä»¶ï¼‰çš„å½¢å¼æä¾›ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨è®ºæ–‡ä¸­æ‰¾åˆ°ã€‚ä¸€æ—¦æˆ‘ä»¬å†³å®šå¼€æºè¿™äº›ä»£ç ï¼Œæˆ‘ä»¬ä¼šç¬¬ä¸€æ—¶é—´é€šçŸ¥æ‚¨ã€‚**

## åœ¨çº¿æ¼”ç¤ºï¼Œå¿«æ¥ä½“éªŒå§ï¼
* åœ¨çº¿æ¼”ç¤ºï¼š[https://outer-perfectdou-demo-gzailab.nie.netease.com](https://outer-perfectdou-demo-gzailab.nie.netease.com)

## å…³äº PerfectDou

PerfectDou æ˜¯ç›®å‰æœ€å…ˆè¿›çš„[æ–—åœ°ä¸»](https://baike.baidu.com/item/%E6%96%97%E5%9C%B0%E4%B8%BB/177997) ([DouDizhu](https://en.wikipedia.org/wiki/Dou_dizhu)) AIç³»ç»Ÿï¼Œç”±**ç½‘æ˜“æ¸¸æˆAIå®éªŒå®¤**ä¸**ä¸Šæµ·äº¤é€šå¤§å­¦**å’Œ**å¡å†…åŸºæ¢…éš†å¤§å­¦**å…±åŒå¼€å‘ã€‚

æ‰€æå‡ºçš„å®Œç¾ä¿¡æ¯è’¸é¦æŠ€æœ¯ï¼ˆä¸€ä¸ªå®Œç¾è®­ç»ƒ-ä¸å®Œç¾æ‰§è¡Œæ¡†æ¶ï¼‰å…è®¸æ™ºèƒ½ä½“åˆ©ç”¨å…¨å±€ä¿¡æ¯æ¥æŒ‡å¯¼ç­–ç•¥è®­ç»ƒï¼Œå°±åƒåœ¨å®Œç¾ä¿¡æ¯æ¸¸æˆä¸­ä¸€æ ·ï¼Œè€Œè®­ç»ƒå¥½çš„ç­–ç•¥å¯ä»¥åœ¨å®é™…æ¸¸æˆè¿‡ç¨‹ä¸­ç”¨äºä¸å®Œç¾ä¿¡æ¯æ¸¸æˆã€‚

<img width="500" src="images/result.jpg" alt="result" />

æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬çš„[è®ºæ–‡](https://arxiv.org/abs/2203.16406)ï¼Œå…¶ä¸­å±•ç¤ºäº†PerfectDouå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆèƒ½å¤Ÿå‡»è´¥æ‰€æœ‰ç°æœ‰çš„AIç¨‹åºï¼Œå¹¶è¾¾åˆ°æœ€å…ˆè¿›çš„æ€§èƒ½ã€‚

*   è®ºæ–‡é“¾æ¥ï¼š[https://arxiv.org/abs/2203.16406](https://arxiv.org/abs/2203.16406)


## å¼•ç”¨æœ¬å·¥ä½œ

```bibtex
@inproceedings{yang2022perfectdou,
  title={PerfectDou: Dominating DouDizhu with Perfect Information Distillation},
  author={Yang, Guan and Liu, Minghuan and Hong, Weijun and Zhang, Weinan and Fang, Fei and Zeng, Guangjun and Lin, Yue},
  booktitle={NeurIPS},
  year={2022}
}
```

## è¯„ä¼°æµç¨‹
é¢„è®­ç»ƒæ¨¡å‹åœ¨ `perfectdou/model/` ä¸­æä¾›ã€‚ä¸ºäº†ä¾¿äºæ¯”è¾ƒï¼Œæ¸¸æˆç¯å¢ƒå’Œè¯„ä¼°æ–¹æ³•ä¸ [DouZero](https://github.com/kwai/DouZero/tree/main/douzero/evaluation) ä¸­çš„ç›¸åŒã€‚

è¿˜æä¾›äº†ä¸€äº›é¢„è®­ç»ƒæ¨¡å‹å’Œå¯å‘å¼æ–¹æ³•ä½œä¸ºåŸºçº¿ï¼š
*   [random](douzero/evaluation/random_agent.py)ï¼šéšæœºï¼ˆå‡åŒ€ï¼‰æ¸¸æˆçš„æ™ºèƒ½ä½“
*   [rlcard](douzero/evaluation/rlcard_agent.py)ï¼š[RLCard](https://github.com/datamllab/rlcard) ä¸­åŸºäºè§„åˆ™çš„æ™ºèƒ½ä½“
*   [DouZero](https://github.com/kwai/DouZero)ï¼šADPï¼ˆå¹³å‡å·®åˆ†ç‚¹æ•°ï¼‰ç‰ˆæœ¬
*  PerfectDouï¼šè®ºæ–‡ä¸­çš„ 2.5e9 å¸§ç‰ˆæœ¬

### æ­¥éª¤ 0ï¼šå‡†å¤‡ç¯å¢ƒ

é¦–å…ˆï¼Œå…‹éš†ä»£ç åº“ï¼š
```
git clone https://github.com/Netease-Games-AI-Lab-Guangzhou/PerfectDou.git
```
ç¡®ä¿æ‚¨å·²å®‰è£… Python 3.7ï¼Œç„¶åä½¿ç”¨ uv å®‰è£…ä¾èµ–ï¼š
```
cd PerfectDou
uv sync
```

æˆ–è€…ï¼Œå¦‚æœæ‚¨æ²¡æœ‰å®‰è£… uvï¼Œå¯ä»¥å…ˆå®‰è£… uvï¼š
```
# Windows
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

cd PerfectDou
uv sync
```

å¦‚æœæ‚¨éœ€è¦å¼€å‘ä¾èµ–ï¼ˆç”¨äºæµ‹è¯•å’Œä»£ç æ ¼å¼åŒ–ï¼‰ï¼Œè¯·è¿è¡Œï¼š
```
uv sync --extra dev
```

### æ­¥éª¤ 1ï¼šç”Ÿæˆè¯„ä¼°æ•°æ®
```
uv run generate-eval
```
ä¸€äº›é‡è¦çš„è¶…å‚æ•°å¦‚ä¸‹ï¼š
*   `--output`ï¼šä¿å­˜åºåˆ—åŒ–æ•°æ®çš„ä½ç½®
*   `--num_games`ï¼šå°†ç”Ÿæˆå¤šå°‘ä¸ªéšæœºæ¸¸æˆï¼Œé»˜è®¤ä¸º 10000

### æ­¥éª¤ 2ï¼šè‡ªæˆ‘å¯¹å¼ˆ
```
uv run evaluate
```
ä¸€äº›é‡è¦çš„è¶…å‚æ•°å¦‚ä¸‹ï¼š
*   `--landlord`ï¼šå“ªä¸ªæ™ºèƒ½ä½“å°†æ‰®æ¼”åœ°ä¸»ï¼Œå¯ä»¥æ˜¯ randomã€rlcardã€douzeroã€perfectdou æˆ–é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„
*   `--landlord_up`ï¼šå“ªä¸ªæ™ºèƒ½ä½“å°†æ‰®æ¼”åœ°ä¸»ä¸Šå®¶ï¼ˆåœ°ä¸»å‰é¢çš„ç©å®¶ï¼‰ï¼Œå¯ä»¥æ˜¯ randomã€rlcardã€douzeroã€perfectdou æˆ–é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„
*   `--landlord_down`ï¼šå“ªä¸ªæ™ºèƒ½ä½“å°†æ‰®æ¼”åœ°ä¸»ä¸‹å®¶ï¼ˆåœ°ä¸»åé¢çš„ç©å®¶ï¼‰ï¼Œå¯ä»¥æ˜¯ randomã€rlcardã€douzeroã€perfectdou æˆ–é¢„è®­ç»ƒæ¨¡å‹çš„è·¯å¾„
*   `--eval_data`ï¼šåŒ…å«è¯„ä¼°æ•°æ®çš„ pickle æ–‡ä»¶
*   `--num_workers`ï¼šå°†ä½¿ç”¨å¤šå°‘ä¸ªå­è¿›ç¨‹

ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è¯„ä¼° PerfectDou åœ¨åœ°ä¸»ä½ç½®å¯¹æŠ— DouZero æ™ºèƒ½ä½“ï¼š
```
uv run evaluate --landlord perfectdou --landlord_up douzero --landlord_down douzero
```

## ğŸ® å®æˆ˜åŠ©æ‰‹åŠŸèƒ½

æˆ‘ä»¬æ–°å¢äº†**æ–—åœ°ä¸»å®æˆ˜åŠ©æ‰‹**åŠŸèƒ½ï¼Œä¸ºæ‚¨çš„å®é™…å¯¹æˆ˜æä¾›AIå†³ç­–æ”¯æŒï¼

### å¿«é€Ÿå¼€å§‹
```bash
# å¯åŠ¨å®æˆ˜åŠ©æ‰‹
uv run battle

# æˆ–è¿è¡Œæ¼”ç¤º
uv run demo
```

### ä¸»è¦ç‰¹æ€§
- **ğŸ¤– AIæ™ºèƒ½å†³ç­–**ï¼šåŸºäºPerfectDouæ¨¡å‹æä¾›æœ€ä¼˜å‡ºç‰Œå»ºè®®
- **ğŸ“Š å®æ—¶çŠ¶æ€è·Ÿè¸ª**ï¼šç®¡ç†æ¸¸æˆè¿›ç¨‹ã€æ‰‹ç‰Œå˜åŒ–ã€å‡ºç‰Œå†å²
- **ğŸ¯ å¤šæ ¼å¼è¾“å…¥**ï¼šæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€ç®€åŒ–ç­‰å¤šç§ç‰Œå‹è¾“å…¥
- **ğŸ’¡ ç­–ç•¥åˆ†æ**ï¼šæä¾›å‡ºç‰Œç†ç”±å’Œç½®ä¿¡åº¦è¯„ä¼°
- **ğŸ¨ å‹å¥½ç•Œé¢**ï¼šç›´è§‚çš„å‘½ä»¤è¡Œäº¤äº’ä½“éªŒ

### ä½¿ç”¨ç¤ºä¾‹
```bash
# 1. é€‰æ‹©èº«ä»½ï¼ˆåœ°ä¸»/åœ°ä¸»ä¸Šå®¶/åœ°ä¸»ä¸‹å®¶ï¼‰
è¯·é€‰æ‹©æ‚¨çš„èº«ä»½ï¼š
1. åœ°ä¸»
2. åœ°ä¸»ä¸Šå®¶ï¼ˆå†œæ°‘ï¼‰
3. åœ°ä¸»ä¸‹å®¶ï¼ˆå†œæ°‘ï¼‰

# 2. è¾“å…¥æ‰‹ç‰Œï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
æ‰‹ç‰Œ: 3 4 5 6 7 8 9 10 J Q K A 2 å°ç‹ å¤§ç‹
# æˆ–ç®€åŒ–è¾“å…¥: 3456789TJQKA2å°å¤§

# 3. è·å–AIå»ºè®®
ğŸ¤– AIå»ºè®®ï¼š
  1. K (å•å¼ K) - ç½®ä¿¡åº¦:90%
     ç†ç”±ï¼šAIæ™ºèƒ½ä½“æ¨è
  2. pass (è¿‡ç‰Œ) - ç½®ä¿¡åº¦:60%
     ç†ç”±ï¼šè¿‡ç‰Œç­‰å¾…æ—¶æœº

# 4. è¾“å…¥æ‚¨çš„é€‰æ‹©
è¯·å‡ºç‰Œï¼ˆè¾“å…¥'pass'è¿‡ç‰Œï¼Œ'help'æŸ¥çœ‹å¸®åŠ©ï¼‰: K
```

### åŠŸèƒ½æµ‹è¯•
```bash
# è¿è¡ŒåŠŸèƒ½æµ‹è¯•
uv run python tests/test_battle_assistant.py

# æˆ–è¿è¡Œæ‰€æœ‰æµ‹è¯•
uv run python -m pytest tests/ -v
```

### ğŸ“š ç›¸å…³æ–‡æ¡£
- **[å®æˆ˜åŠ©æ‰‹ä½¿ç”¨æŒ‡å—](docs/battle_assistant_guide.md)**: è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’ŒæŠ€å·§
- **[å¼€å‘æŒ‡å—](docs/development_guide.md)**: å¼€å‘ç¯å¢ƒè®¾ç½®å’Œè´¡çŒ®æŒ‡å—
- **[é¡¹ç›®æ¦‚è§ˆ](docs/project_overview.md)**: é¡¹ç›®ç»“æ„å’ŒåŠŸèƒ½æ¦‚è¿°

## è‡´è°¢
*   æ¼”ç¤ºä¸»è¦åŸºäº [RLCard-Showdown](https://github.com/datamllab/rlcard-showdown)
*   è¯„ä¼°ä»£ç å’Œæ¸¸æˆç¯å¢ƒå®ç°ä¸»è¦åŸºäº [DouZero](https://github.com/kwai/DouZero)

## è”ç³»æˆ‘ä»¬
å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚

yangguan@corp.netease.com

minghuanliu@sjtu.edu.cn

hongweijun@corp.netease.com

gzzengguangjun@corp.netease.com














